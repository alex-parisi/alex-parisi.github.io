<!doctype html>
<html lang="en" data-bs-theme="auto">
<head>
    <title>Parisipedia</title>
    <script src="../js/color-modes.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Alex Parisi">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/blog/">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .b-example-divider {
            width: 100%;
            height: 3rem;
            background-color: rgba(0, 0, 0, .1);
            border: solid rgba(0, 0, 0, .15);
            border-width: 1px 0;
            box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
        }

        .b-example-vr {
            flex-shrink: 0;
            width: 1.5rem;
            height: 100vh;
        }

        .bi {
            vertical-align: -.125em;
            fill: currentColor;
        }

        .nav-scroller {
            position: relative;
            z-index: 2;
            height: 2.75rem;
            overflow-y: hidden;
        }

        .nav-scroller .nav {
            display: flex;
            flex-wrap: nowrap;
            padding-bottom: 1rem;
            margin-top: -1px;
            overflow-x: auto;
            text-align: center;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .btn-bd-primary {
            --bd-violet-bg: #712cf9;
            --bd-violet-rgb: 112.520718, 44.062154, 249.437846;
            --bs-btn-font-weight: 600;
            --bs-btn-color: var(--bs-white);
            --bs-btn-bg: var(--bd-violet-bg);
            --bs-btn-border-color: var(--bd-violet-bg);
            --bs-btn-hover-color: var(--bs-white);
            --bs-btn-hover-bg: #6528e0;
            --bs-btn-hover-border-color: #6528e0;
            --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
            --bs-btn-active-color: var(--bs-btn-hover-color);
            --bs-btn-active-bg: #5a23c8;
            --bs-btn-active-border-color: #5a23c8;
        }

        .bd-mode-toggle {
            z-index: 1500;
        }

        .bd-mode-toggle .dropdown-menu .active .bi {
            display: block !important;
        }

        .reveal pre code, .hljs {
            background-color: #C1C1C1 !important;
        }
        .reveal pre, .hljs {
            box-shadow: none !important;
        }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Playfair&#43;Display:700,900&amp;display=swap" rel="stylesheet">
    <link href="../css/blog.css" rel="stylesheet">
</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
    <symbol id="check2" viewBox="0 0 16 16">
        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
    </symbol>
    <symbol id="circle-half" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
    </symbol>
    <symbol id="moon-stars-fill" viewBox="0 0 16 16">
        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
    </symbol>
    <symbol id="sun-fill" viewBox="0 0 16 16">
        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
    </symbol>
</svg>
<div class="dropdown position-fixed bottom-0 end-0 mb-3 me-3 bd-mode-toggle">
    <button class="btn btn-bd-primary py-2 dropdown-toggle d-flex align-items-center"
            id="bd-theme"
            type="button"
            aria-expanded="false"
            data-bs-toggle="dropdown"
            aria-label="Toggle theme (auto)">
        <svg class="bi my-1 theme-icon-active" width="1em" height="1em">
            <use href="#circle-half"></use>
        </svg>
        <span class="visually-hidden" id="bd-theme-text">Toggle theme</span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="bd-theme-text">
        <li>
            <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light"
                    aria-pressed="false">
                <svg class="bi me-2 opacity-50" width="1em" height="1em">
                    <use href="#sun-fill"></use>
                </svg>
                Light
                <svg class="bi ms-auto d-none" width="1em" height="1em">
                    <use href="#check2"></use>
                </svg>
            </button>
        </li>
        <li>
            <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark"
                    aria-pressed="false">
                <svg class="bi me-2 opacity-50" width="1em" height="1em">
                    <use href="#moon-stars-fill"></use>
                </svg>
                Dark
                <svg class="bi ms-auto d-none" width="1em" height="1em">
                    <use href="#check2"></use>
                </svg>
            </button>
        </li>
        <li>
            <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto"
                    aria-pressed="true">
                <svg class="bi me-2 opacity-50" width="1em" height="1em">
                    <use href="#circle-half"></use>
                </svg>
                Auto
                <svg class="bi ms-auto d-none" width="1em" height="1em">
                    <use href="#check2"></use>
                </svg>
            </button>
        </li>
    </ul>
</div>
<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
    <symbol id="aperture" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
            stroke-width="2" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10"/>
        <path d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83m13.79-4l-5.74 9.94"/>
    </symbol>
    <symbol id="cart" viewBox="0 0 16 16">
        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
    </symbol>
    <symbol id="chevron-right" viewBox="0 0 16 16">
        <path fill-rule="evenodd"
              d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
    </symbol>
</svg>
<div class="container">
    <div class="nav-scroller py-1 mb-3 border-bottom">
        <nav class="nav nav-underline justify-content-between">
            <a class="nav-item nav-link link-body-emphasis" href="javascript:history.back()">Back</a>
            <a class="nav-item nav-link link-body-emphasis" href="wiki.html">Wiki Home</a>
            <a class="nav-item nav-link link-body-emphasis" href="../index.html">Main Home</a>
        </nav>
    </div>
</div>

<main class="container">
    <div class="row g-5">
        <div class="col-md-8 p-4">
            <h1>Digital Biquad Filters</h1>
            <br>
            <h5 class="fst-italic">Second order recursive linear filtering</h5>
            <hr>
            <h3>Brief:</h3>
            <br>
            <p> <i>Biquad</i> refers to the fact that the transfer function of the filter is the ratio of two quadratic functions:</p>
            <p>\(H(z) = {b_{0} + b_{1}z^{-1} + b_{2}z^{-2} \over {a_{0} + a_{1}z^{-1} + a_{2}z^{-2}}}\)</p>
            <p>Higher-order IIR filters are prone to instability due to coefficient quantization, so they are often implemented as cascaded biquad sections, ensuring all poles remain inside the unit circle in the Z-domain for stability.</p>
            <p>Second order filters are also very simple to implement, as they only require managing six coefficient values and four state values. Implementing a biquad filter is as simple as defining the difference equation:</p>
            <p>\( y_{n} = {b_{0} \over a_{0}}x_{n} + {b_{1} \over a_{0}}x_{n - 1} + {b_{2} \over a_{0}}x_{n - 2} - {a_{1} \over a_{0}}y_{n - 1} - {a_{2} \over a_{0}}y_{n - 2}\)</p>
            <hr>
            <h3>C++ Implementation:</h3>
            <br>
            <pre><code>/// DigitalBiquadFilter.h

/**
Copyright © 2025 Alex Parisi

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

#ifndef DIGITAL_BIQUAD_FILTER_H
#define DIGITAL_BIQUAD_FILTER_H

#include &lt;array&gt;
#include &lt;concepts&gt;
#include &lt;optional&gt;
#include &lt;vector&gt;

#include "Logging.h"

/**
 * @brief Coefficients Struct
 * @details A struct containing the coefficients of a digital biquad filter
 */
template&lt;std::floating_point T&gt;
struct Coefficients {
    T b0, b1, b2, a0, a1, a2;
};

/**
 * @brief State Struct
 * @details A struct containing the state variables of a digital biquad filter
 */
template&lt;std::floating_point T&gt;
struct State {
    T x1, x2, y1, y2;
};

/**
 * @brief Digital Biquad Filter
 * @details A digital biquad filter is a type of infinite impulse response
 * filter. The transfer function is defined by the following equation: H(z) =
 * (b0 + b1*z^-1 + b2*z^-2) / (a0 + a1*z^-1 + a2*z^-2) The filter is implemented
 * by applying the following difference equation: y[n] = b0*x[n] + b1*x[n-1] +
 * b2*x[n-2] - a1*y[n-1] - a2*y[n-2]
 */
template&lt;std::floating_point T, size_t blockSize = 0&gt;
class DigitalBiquadFilter {
public:
    /**
     * @brief Public Constructor
     * @details Creates a filter with specified coefficients
     * @param coefficients A Coefficients struct containing the filter
     * coefficients: b0, b1 b2, a0, a1, a2
     * @see Coefficients
     */
    static auto create(const Coefficients&lt;T&gt; &coefficients)
            -&gt; std::optional&lt;DigitalBiquadFilter&gt; {
        if (coefficients.a0 == 0.0) {
            LOG_E("DigitalBiquadFilter",
                  "Error creating DigitalBiquadFilter object: the a0 "
                  "coefficient cannot be zero");
            return std::nullopt;
        }
        return DigitalBiquadFilter(coefficients);
    }
    /**
     * @brief Process a sample
     * @details Processes a single sample of audio data
     * @param sample The input sample
     */
    auto process(const T &sample) -&gt; T {
        const T output =
                ((m_coefficients.b0 / m_coefficients.a0) * sample) +
                ((m_coefficients.b1 / m_coefficients.a0) * m_state.x1) +
                ((m_coefficients.b2 / m_coefficients.a0) * m_state.x2) -
                ((m_coefficients.a1 / m_coefficients.a0) * m_state.y1) -
                ((m_coefficients.a2 / m_coefficients.a0) * m_state.y2);
        m_state.x2 = m_state.x1;
        m_state.x1 = sample;
        m_state.y2 = m_state.y1;
        m_state.y1 = output;

        m_iter++;
        return output;
    }
    /**
     * @brief Process a block of samples
     * @details Processes a block of samples of audio data
     * @param samples A pointer to the block of samples. The samples are edited
     * in-place. This assumes that the pointer has enough memory allocated to
     * pull out blockSize samples and is inherently unsafe. For block,
     * processing, it's safer to use the block process methods with either a
     * std::vector or std::array.
     */
    auto process(T *samples) -&gt; void {
        if (blockSize &lt;= 0) {
            LOG_E("DigitalBiquadFilter",
                  "Error processing block of samples: blockSize must be "
                  "greater than zero.");
            return;
        }
        if (samples == nullptr) {
            LOG_E("DigitalBiquadFilter",
                  "Error processing block of samples: samples pointer is null");
            return;
        }
        for (size_t i = 0; i &lt; blockSize; ++i) {
            samples[i] = process(samples[i]);
        }
    }
    /**
     * @brief Process a block of samples
     * @details Processes a block of samples of audio data. Since this method
     * uses a std::vector as input, we don't need to rely on blockSize being
     * passed in. The samples are edited in place.
     * @param samples A vector of samples
     */
    auto process(std::vector&lt;T&gt; &samples) -&gt; void {
        if (samples.empty()) {
            LOG_E("DigitalBiquadFilter",
                  "Error processing block of samples: samples vector is empty");
            return;
        }
        for (auto &sample: samples) {
            sample = process(sample);
        }
    }
    /**
     * @brief Process a block of samples
     * @details Processes a block of samples of audio data. The samples are
     * edited in place.
     * @param samples An array of samples
     */
    auto process(std::array&lt;T, blockSize&gt; &samples) -&gt; void {
        if (blockSize &lt;= 0) {
            LOG_E("DigitalBiquadFilter", "Error processing block of samples: "
                                         "blockSize must be greater than zero");
            return;
        }
        for (size_t i = 0; i &lt; blockSize; ++i) {
            samples[i] = process(samples[i]);
        }
    }
    /**
     * @brief Set the filter coefficients
     * @details Sets the filter coefficients to custom values
     * @param coefficients A Coefficients struct containing the filter
     * coefficients: b0, b1 b2, a0, a1, a2
     * @see Coefficients
     */
    auto set_coefficients(const Coefficients&lt;T&gt; &coefficients) -&gt; void {
        m_coefficients = coefficients;
        reset();
    }
    /**
     * @brief Reset the filter
     * @details Resets the filter state variables
     */
    auto reset() -&gt; void {
        m_state.x1 = 0.0;
        m_state.x2 = 0.0;
        m_state.y1 = 0.0;
        m_state.y2 = 0.0;
        m_iter = 0;
    }

private:
    /**
     * @brief Private Constructor
     * @details Initializes the filter with specified coefficients
     * @param coefficients A Coefficients struct containing the filter
     * coefficients: b0, b1 b2, a0, a1, a2
     * @see Coefficients
     */
    explicit DigitalBiquadFilter(const Coefficients&lt;T&gt; &coefficients) :
        m_coefficients(coefficients) {}

    /** The filter coefficients */
    Coefficients&lt;T&gt; m_coefficients = {};

    /** The filter state variables */
    State&lt;T&gt; m_state = {};

    /** The number of iterations */
    long long m_iter = 0LL;
};

#endif // DIGITAL_BIQUAD_FILTER_H</code></pre>
            <hr>
            <h3>Notes:</h3>
            <br>
            <ul>
                <li>There is a <a href="concepts.html">concept</a> applied to the templated coefficients struct, state struct, and filter class: <code>std::floating_point</code>. This ensures that the <code>DigitalBiquadFilter</code> class can only be templated with a <code>float</code> or <code>double</code> type.</li>
                <li>To reduce the chance of encountering quantization noise, it's recommended to always template the <code>DigitalBiquadFilter</code> class with a <code>double</code> type.</li>
            </ul>
        </div>

        <div class="col-md-4">
            <div class="position-sticky" style="top: 2rem;">
                <div class="p-4 mb-3 bg-body-tertiary rounded">
                    <h4 class="fst-italic">Table Of Contents</h4>
                    <h5>Audio Topics</h5>
                    <ul>
                        <li><a href="circularBuffer.html">Circular Buffers</a></li>
                        <li><a href="#"><b>Digital Biquad Filters</b></a></li>
                        <ul>
                            <li><a href="lowPassFilter.html">Low Pass Filters</a></li>
                            <li><a href="highPassFilter.html">High Pass Filter</a></li>
                        </ul>
                    </ul>
                    <h5>C++ Topics</h5>
                    <ul>
                        <li><a href="concepts.html">Concepts (C++20)</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</main>

<footer class="py-5 text-center text-body-secondary bg-body-tertiary">
    <p>© 2025 Alex Parisi</a>.
    </p>
    <p class="mb-0">
        <a href="#">Back to top</a>
    </p>
</footer>
<script src="../js/bootstrap.bundle.min.js"></script>

</body>
</html>
